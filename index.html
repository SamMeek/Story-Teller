<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
            integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
            crossorigin="anonymous" referrerpolicy="no-referrer" />
        <title>Single Page</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                height: 100vh;
                width: 100vw;
                overflow: hidden;
            }

            .container {
                height: 100%;
                width: 100%;
                display: flex;
                justify-content: center;
                align-items: center;
                background-color: #f0f0f0;
            }

            .content {
                padding: 2rem;
                background-color: white;
                border-radius: 8px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }
        </style>
    </head>

    <body>
        <!-- Main Container -->
        <div class="container">
            <canvas id="bg-canvas"></canvas>
            <div class="content">
                <h1>Dancing Plague of 1518</h1>
                <div class="story-controls">
                    <button id="playBtn" class="control-btn">
                        <i class="fas fa-play"></i> Play Story
                    </button>
                    <button id="pauseBtn" class="control-btn" disabled>
                        <i class="fas fa-pause"></i> Pause
                    </button>
                </div>
                <div class="story-content">
                    <p class="story-text">Once upon a time, in the sweltering summer...</p>
                </div>
            </div>
        </div>

        <style>
            .container {
                position: relative;
                background: linear-gradient(45deg, #1a1a1a, #2d2d2d);
            }

            .content {
                position: absolute;
                top: 20%;
                left: 50%;
                transform: translateX(-50%);
                z-index: 1;
                background: rgba(18, 18, 18, 0.7);
                backdrop-filter: blur(10px);
                -webkit-backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.1);
                box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5);
                padding: 2.5rem;
                border-radius: 15px;
                max-width: 600px;
                width: 90%;
            }

            .content h1 {
                color: #00ff88;
                text-shadow: 0 0 10px rgba(0, 255, 136, 0.3);
                font-size: 2.5rem;
                margin-bottom: 1.5rem;
                font-weight: 700;
                text-align: center;
            }

            .story-controls {
                display: flex;
                justify-content: center;
                gap: 1rem;
                margin-bottom: 2rem;
            }

            .control-btn {
                padding: 0.8rem 1.5rem;
                border: none;
                border-radius: 8px;
                background: rgba(0, 255, 136, 0.2);
                color: #00ff88;
                font-size: 1rem;
                cursor: pointer;
                transition: all 0.3s ease;
                border: 1px solid rgba(0, 255, 136, 0.3);
            }

            .control-btn:hover {
                background: rgba(0, 255, 136, 0.3);
            }

            .control-btn:disabled {
                opacity: 0.5;
                cursor: not-allowed;
            }

            .story-text {
                color: #e0e0e0;
                font-size: 1.1rem;
                line-height: 1.6;
                text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
                text-align: center;
            }
        </style>

        <div class="research-icons">
            <a class="research-icon" title="Resources" onclick="resourcesModal()">
                <i class="fas fa-file-alt"></i>
            </a>
            <a href="https://github.com/SamMeek" target="_blank" class="research-icon" title="GitHub Repository">
                <i class="fab fa-github"></i>
            </a>
        </div>
        <div id="resourcesModal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h2 style="color: #00ff88;">Resources</h2>
                <div class="resources-list">
                    <a href="./research-paper.pdf" class="resource-item" download>
                        <i class="fas fa-file-pdf"></i>
                        <span>Research Paper</span>
                    </a>
                    <a href="https://en.wikipedia.org/wiki/Dancing_Plague_of_1518" target="_blank"
                        class="resource-item">
                        <i class="fa-brands fa-wikipedia-w"></i>
                        <span>Wikipedia</span>
                    </a>
                    <a href="https://youtu.be/TKhVE-pP7hA" target="_blank" class="resource-item">
                        <i class="fa-brands fa-youtube"></i>
                        <span>Video</span>
                    </a>
                </div>
            </div>
        </div>

        <style>
            .modal {
                display: none;
                position: fixed;
                z-index: 1001;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.8);
            }

            .modal-content {
                background-color: #1a1a1a;
                margin: 15% auto;
                padding: 2rem;
                border: 1px solid rgba(0, 255, 136, 0.3);
                border-radius: 12px;
                width: 80%;
                max-width: 500px;
                position: relative;
            }

            .close {
                color: #00ff88;
                float: right;
                font-size: 1.5rem;
                font-weight: bold;
                cursor: pointer;
            }

            .close:hover {
                color: #00cc6a;
            }

            .resources-list {
                display: flex;
                flex-direction: column;
                gap: 1rem;
                margin-top: 1.5rem;
            }

            .resource-item {
                display: flex;
                align-items: center;
                gap: 1rem;
                padding: 1rem;
                background: rgba(0, 255, 136, 0.1);
                border: 1px solid rgba(0, 255, 136, 0.2);
                border-radius: 8px;
                color: #00ff88;
                text-decoration: none;
                transition: all 0.3s ease;
            }

            .resource-item:hover {
                background: rgba(0, 255, 136, 0.2);
                transform: translateX(5px);
            }

            .resource-item i {
                font-size: 1.2rem;
            }
        </style>

        <script>
            function resourcesModal() {
                const modal = document.getElementById("resourcesModal");
                modal.style.display = "block";

                const closeBtn = document.getElementsByClassName("close")[0];
                closeBtn.onclick = function () {
                    modal.style.display = "none";
                }

                window.onclick = function (event) {
                    if (event.target == modal) {
                        modal.style.display = "none";
                    }
                }
            }
        </script>


        <style>
            .research-icons {
                position: fixed;
                bottom: 20px;
                left: 20px;
                display: flex;
                flex-direction: column;
                gap: 1rem;
                z-index: 1000;
            }

            .research-icon {
                width: 40px;
                height: 40px;
                display: flex;
                align-items: center;
                justify-content: center;
                background: rgba(0, 255, 136, 0.2);
                border: 1px solid rgba(0, 255, 136, 0.3);
                border-radius: 8px;
                color: #00ff88;
                text-decoration: none;
                transition: all 0.3s ease;
            }

            .research-icon:hover {
                background: rgba(0, 255, 136, 0.3);
                transform: translateY(-2px);
            }

            .research-icon i {
                font-size: 1.2rem;
            }
        </style>


        <!-- Three.js Setup -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
        <audio id="backgroundMusic" loop autoplay>
            <source src="./music.mp3" type="audio/mpeg">
        </audio>
        <script>
            // Three.js setup
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({
                canvas: document.querySelector('#bg-canvas'),
                alpha: true
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);

            // Create particles
            const particlesGeometry = new THREE.BufferGeometry();
            const particlesCount = 1000;
            const posArray = new Float32Array(particlesCount * 3);

            for (let i = 0; i < particlesCount * 3; i++) {
                posArray[i] = (Math.random() - 0.5) * 50;
            }

            particlesGeometry.setAttribute('position', new THREE.BufferAttribute(posArray, 3));

            const particlesMaterial = new THREE.PointsMaterial({
                size: 0.005,
                color: 0x00ff88,
                transparent: true,
                opacity: 0.6
            });

            const particlesMesh = new THREE.Points(particlesGeometry, particlesMaterial);
            scene.add(particlesMesh);

            // Create animated background
            const geometry = new THREE.SphereGeometry(10, 3, 16, 100);
            const material = new THREE.MeshStandardMaterial({
                color: 0x00ff88,
                emissive: 0x00ff88,
                emissiveIntensity: 0.05
            });
            const torus = new THREE.Mesh(geometry, material);
            scene.add(torus);

            // Add lights
            const pointLight = new THREE.PointLight(0x00ff88);
            pointLight.position.set(5, 5, 5);
            scene.add(pointLight);

            const ambientLight = new THREE.AmbientLight(0x404040);
            scene.add(ambientLight);

            camera.position.z = 30;

            // Animation loop
            function animate() {
                requestAnimationFrame(animate);
                torus.rotation.x += 0.01;
                torus.rotation.y += 0.005;
                particlesMesh.rotation.y += 0.001;
                renderer.render(scene, camera);
            }
            animate();

            // Story and Voice Implementation
            const story = [
                "Once upon a time, in the sweltering summer of July 1518, the cobbled streets of Strasbourg, then part of Alsace in the Holy Roman Empire, bustled with the clang of blacksmiths, cries of merchants, and the restless murmurs of a people weathered by famine, disease, and superstition...",
                "On July 14th, 1518, a woman named Frau Troffea emerged from her modest home and, without a word, began to dance in the middle of the narrow street, a strange, frenzied dance with no music, no joy, and no apparent reason...",
                "Witnesses later claimed she seemed to be in a trance, arms flailing, feet pounding the stones, sweat pouring from her brow, yet unable to stop herself, even as her shoes shredded and her feet began to bleed...",
                "For six straight days, Frau Troffea danced. By July 20th, more than 30 people had joined her, their bodies overtaken by the same strange compulsion, some collapsing only to rise again and continue...",
                "By the end of July, the number of dancers had swelled to over 100. Men and women of all ages and trades spun, leapt, and shook uncontrollably in streets, courtyards, and even inside churches, to the horror of their families and neighbors...",
                "The Strasbourg city council, fearing the spread of a deadly contagion, turned to local physicians. The consensus: the affliction was not supernatural but the result of 'hot blood', an excess of heat in the body that needed to be released through continued dancing...",
                "Based on this theory, on August 2nd, the authorities did the unthinkable: they erected a stage, cleared a public hall, and even paid musicians to accompany the dancers, believing music and motion might purge the sickness...",
                "But the results were tragic. Eyewitness accounts described victims dancing until their ribs cracked, their hearts failed, and their bodies collapsed in exhaustion. Some reportedly died mid-step. The city descended into panic...",
                "By mid-August, estimates suggested between 300 to 400 people had been affected. Local chroniclers like Paracelsus and the Strasbourg Cathedral canon documented the grim scenes in written records and sermons...",
                "Theories multiplied. Some blamed the curse of Saint Vitus, a 4th-century martyr believed to punish sinners by forcing them into involuntary dancing. Others suspected ergotism, caused by moldy rye bread containing LSD-like compounds...",
                "Others still proposed a form of collective hysteria, a psychological response to the crushing stress of recent plagues, the Little Ice Age's failed harvests, and religious fear sparked by apocalyptic prophecies widespread in early 16th-century Europe...",
                "By August 26th, the authorities reversed course. Music and dancing were banned. The afflicted were transported, some carried, others stumbling, to a mountaintop shrine dedicated to Saint Vitus in Saverne. There, barefoot, they offered offerings and were sprinkled with holy water...",
                "In the weeks that followed, the bizarre plague gradually faded. No new cases were recorded after early September. The city returned to uneasy normalcy, but the mystery remained, unanswered and unnerving...",
                "Centuries later, the event is confirmed by contemporary physicians’ notes, council records, and chronicles such as those by the physician Theodore Scribonius and the Strasbourg chronicle of 1519...",
                "And so, the story of the Dancing Plague of 1518 lives on, a rare moment when history reads like myth, and a city danced itself into the arms of death under a sun that watched and offered no answers...",
                "The End"
            ];


            let currentIndex = 0;
            let speechSynthesis = window.speechSynthesis;
            let utterance = null;
            let isPaused = false;
            let pausedIndex = 0;
            let isPlaying = false;
            const backgroundMusic = document.getElementById('backgroundMusic');

            const playBtn = document.getElementById('playBtn');
            const pauseBtn = document.getElementById('pauseBtn');
            const storyText = document.querySelector('.story-text');

            function speak(text) {
                if (speechSynthesis.speaking) {
                    speechSynthesis.cancel();
                }
                utterance = new SpeechSynthesisUtterance(text);
                utterance.rate = 0.59; // Balanced rate for natural storytelling
                utterance.pitch = 1.0; // Natural pitch for a warm, engaging voice
                utterance.volume = 1.0;

                // Get available voices and set a storytelling voice if available
                let voices = speechSynthesis.getVoices();
                let storytellerVoice = voices.find(voice =>
                    voice.name.includes('Male') ||
                    voice.name.includes('David') ||
                    voice.name.includes('Daniel')
                );
                if (storytellerVoice) {
                    utterance.voice = storytellerVoice;
                }

                utterance.onend = () => {
                    if (!isPaused && isPlaying) {
                        currentIndex = (currentIndex + 1) % story.length;
                        storyText.textContent = story[currentIndex];

                        if (currentIndex < story.length - 1) {
                            speak(story[currentIndex]);
                        } else {
                            isPlaying = false;
                            playBtn.disabled = false;
                            pauseBtn.disabled = true;
                            pauseBtn.innerHTML = '<i class="fas fa-pause"></i> Pause';
                            isPaused = false;
                            backgroundMusic.pause();
                        }
                    }
                };

                speechSynthesis.speak(utterance);
            }

            // Ensure voices are loaded before using them
            speechSynthesis.onvoiceschanged = () => {
                let voices = speechSynthesis.getVoices();
                let storytellerVoice = voices.find(voice =>
                    voice.name.includes('Male') ||
                    voice.name.includes('David') ||
                    voice.name.includes('Daniel')
                );
                if (storytellerVoice) {
                    utterance.voice = storytellerVoice;
                }
            };

            playBtn.addEventListener('click', () => {
                if (speechSynthesis.speaking) {
                    speechSynthesis.cancel();
                }
                isPlaying = true;
                playBtn.disabled = true;
                pauseBtn.disabled = false;
                currentIndex = 0;
                pausedIndex = 0;
                storyText.textContent = story[currentIndex];
                isPaused = false;
                pauseBtn.innerHTML = '<i class="fas fa-pause"></i> Pause';
                backgroundMusic.volume = 0.1; // Lower background music volume
                backgroundMusic.play();
                speak(story[currentIndex]);
            });

            pauseBtn.addEventListener('click', () => {
                if (!isPaused) {
                    speechSynthesis.pause();
                    backgroundMusic.pause();
                    isPaused = true;
                    pausedIndex = currentIndex;
                    pauseBtn.innerHTML = '<i class="fas fa-play"></i> Resume';
                } else {
                    speechSynthesis.resume();
                    backgroundMusic.play();
                    isPaused = false;
                    currentIndex = pausedIndex;
                    storyText.textContent = story[currentIndex];
                    pauseBtn.innerHTML = '<i class="fas fa-pause"></i> Pause';
                    if (currentIndex < story.length - 1) {
                        speak(story[currentIndex]);
                    }
                }
            });

            // GSAP animations
            gsap.from('.content', {
                duration: 1.2,
                y: 100,
                opacity: 0,
                ease: 'power3.out'
            });

            gsap.from('h1', {
                duration: 1.5,
                y: 50,
                opacity: 0,
                delay: 0.5,
                ease: 'elastic.out(1, 0.3)'
            });

            gsap.from('.story-controls', {
                duration: 1,
                y: 30,
                opacity: 0,
                delay: 0.8,
                ease: 'power2.out'
            });

            gsap.from('.story-text', {
                duration: 1,
                y: 30,
                opacity: 0,
                delay: 1,
                ease: 'power2.out'
            });
        </script>
    </body>

</html>